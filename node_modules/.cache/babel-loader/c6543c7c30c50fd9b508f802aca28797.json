{"ast":null,"code":"var e,\n    n = require(\"react\"),\n    t = (e = require(\"resize-observer-polyfill\")) && \"object\" == typeof e && \"default\" in e ? e.default : e,\n    r = {\n  debug: 10,\n  info: 20,\n  warn: 30,\n  error: 40,\n  none: 100\n},\n    i = \"undefined\" != typeof window && window.document && window.document.createElement ? n.useLayoutEffect : n.useEffect;\n\nmodule.exports = function (e) {\n  void 0 === e && (e = {});\n  var o = e.logLevel;\n  void 0 === o && (o = \"info\");\n  var c = e.maxFontSize;\n  void 0 === c && (c = 100);\n  var f = e.minFontSize;\n  void 0 === f && (f = 20);\n  var u = e.onFinish,\n      a = e.onStart,\n      s = e.resolution;\n  void 0 === s && (s = 5);\n  var l = r[o],\n      S = n.useCallback(function () {\n    return {\n      calcKey: 0,\n      fontSize: c,\n      fontSizePrev: f,\n      fontSizeMax: c,\n      fontSizeMin: f\n    };\n  }, [c, f]),\n      d = n.useRef(null),\n      v = n.useRef(),\n      z = n.useRef(!1),\n      m = n.useState(S),\n      w = m[0],\n      M = m[1],\n      h = w.calcKey,\n      y = w.fontSize,\n      x = w.fontSizeMax,\n      b = w.fontSizeMin,\n      g = w.fontSizePrev,\n      F = null,\n      K = n.useState(function () {\n    return new t(function () {\n      F = window.requestAnimationFrame(function () {\n        z.current || (a && a(), z.current = !0, M(Object.assign({}, S(), {\n          calcKey: h + 1\n        })));\n      });\n    });\n  })[0];\n  n.useEffect(function () {\n    return d.current && K.observe(d.current), function () {\n      F && window.cancelAnimationFrame(F), K.disconnect();\n    };\n  }, [F, K]);\n  var E = d.current && d.current.innerHTML;\n  return n.useEffect(function () {\n    0 === h || z.current || (E !== v.current && (a && a(), M(Object.assign({}, S(), {\n      calcKey: h + 1\n    }))), v.current = E);\n  }, [h, S, E, a]), i(function () {\n    if (0 !== h) {\n      var e = Math.abs(y - g) <= s,\n          n = !!d.current && (d.current.scrollHeight > d.current.offsetHeight || d.current.scrollWidth > d.current.offsetWidth),\n          t = y > g;\n      if (e) n && y === g ? (z.current = !1, l <= r.info && console.info(\"[use-fit-text] reached `minFontSize = \" + f + \"` without fitting text\")) : n ? M({\n        fontSize: t ? g : b,\n        fontSizeMax: x,\n        fontSizeMin: b,\n        fontSizePrev: g,\n        calcKey: h\n      }) : (z.current = !1, u && u(y));else {\n        var i,\n            o = x,\n            c = b;\n        n ? (i = t ? g - y : b - y, o = Math.min(x, y)) : (i = t ? x - y : g - y, c = Math.max(b, y)), M({\n          calcKey: h,\n          fontSize: y + i / 2,\n          fontSizeMax: o,\n          fontSizeMin: c,\n          fontSizePrev: y\n        });\n      }\n    }\n  }, [h, y, x, b, g, u, d, s]), {\n    fontSize: y + \"%\",\n    ref: d\n  };\n};","map":{"version":3,"sources":["../index.ts"],"names":["LOG_LEVEL","debug","info","warn","error","none","useIsoLayoutEffect","window","document","createElement","useLayoutEffect","useEffect","logLevel","logLevelOption","initState","useCallback","calcKey","fontSize","maxFontSize","fontSizePrev","minFontSize","fontSizeMax","fontSizeMin","ref","useRef","innerHtmlPrevRef","isCalculatingRef","useState","animationFrameId","ResizeObserver","requestAnimationFrame","current","onStart","setState","Object","ro","observe","cancelAnimationFrame","disconnect","innerHtml","innerHTML","isWithinResolution","Math","abs","resolution","isOverflow","scrollHeight","offsetHeight","scrollWidth","offsetWidth","isAsc","console","onFinish","delta","newMax","newMin","min","max"],"mappings":"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","sourcesContent":["import {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport ResizeObserver from \"resize-observer-polyfill\";\n\nexport type TLogLevel = \"debug\" | \"info\" | \"warn\" | \"error\" | \"none\";\n\nexport type TOptions = {\n  logLevel?: TLogLevel;\n  maxFontSize?: number;\n  minFontSize?: number;\n  onFinish?: (fontSize: number) => void;\n  onStart?: () => void;\n  resolution?: number;\n};\n\nconst LOG_LEVEL: Record<TLogLevel, number> = {\n  debug: 10,\n  info: 20,\n  warn: 30,\n  error: 40,\n  none: 100,\n};\n\n// Suppress `useLayoutEffect` warning when rendering on the server\n// https://gist.github.com/gaearon/e7d97cdf38a2907924ea12e4ebdf3c85\nconst useIsoLayoutEffect =\n  typeof window !== \"undefined\" &&\n  window.document &&\n  window.document.createElement\n    ? useLayoutEffect\n    : useEffect;\n\nconst useFitText = ({\n  logLevel: logLevelOption = \"info\",\n  maxFontSize = 100,\n  minFontSize = 20,\n  onFinish,\n  onStart,\n  resolution = 5,\n}: TOptions = {}) => {\n  const logLevel = LOG_LEVEL[logLevelOption];\n\n  const initState = useCallback(() => {\n    return {\n      calcKey: 0,\n      fontSize: maxFontSize,\n      fontSizePrev: minFontSize,\n      fontSizeMax: maxFontSize,\n      fontSizeMin: minFontSize,\n    };\n  }, [maxFontSize, minFontSize]);\n\n  const ref = useRef<HTMLDivElement>(null);\n  const innerHtmlPrevRef = useRef<string>();\n  const isCalculatingRef = useRef(false);\n  const [state, setState] = useState(initState);\n  const { calcKey, fontSize, fontSizeMax, fontSizeMin, fontSizePrev } = state;\n\n  // Montior div size changes and recalculate on resize\n  let animationFrameId: number | null = null;\n  const [ro] = useState(\n    () =>\n      new ResizeObserver(() => {\n        animationFrameId = window.requestAnimationFrame(() => {\n          if (isCalculatingRef.current) {\n            return;\n          }\n          onStart && onStart();\n          isCalculatingRef.current = true;\n          // `calcKey` is used in the dependencies array of\n          // `useIsoLayoutEffect` below. It is incremented so that the font size\n          // will be recalculated even if the previous state didn't change (e.g.\n          // when the text fit initially).\n          setState({\n            ...initState(),\n            calcKey: calcKey + 1,\n          });\n        });\n      }),\n  );\n\n  useEffect(() => {\n    if (ref.current) {\n      ro.observe(ref.current);\n    }\n    return () => {\n      animationFrameId && window.cancelAnimationFrame(animationFrameId);\n      ro.disconnect();\n    };\n  }, [animationFrameId, ro]);\n\n  // Recalculate when the div contents change\n  const innerHtml = ref.current && ref.current.innerHTML;\n  useEffect(() => {\n    if (calcKey === 0 || isCalculatingRef.current) {\n      return;\n    }\n    if (innerHtml !== innerHtmlPrevRef.current) {\n      onStart && onStart();\n      setState({\n        ...initState(),\n        calcKey: calcKey + 1,\n      });\n    }\n    innerHtmlPrevRef.current = innerHtml;\n  }, [calcKey, initState, innerHtml, onStart]);\n\n  // Check overflow and resize font\n  useIsoLayoutEffect(() => {\n    // Don't start calculating font size until the `resizeKey` is incremented\n    // above in the `ResizeObserver` callback. This avoids an extra resize\n    // on initialization.\n    if (calcKey === 0) {\n      return;\n    }\n\n    const isWithinResolution = Math.abs(fontSize - fontSizePrev) <= resolution;\n    const isOverflow =\n      !!ref.current &&\n      (ref.current.scrollHeight > ref.current.offsetHeight ||\n        ref.current.scrollWidth > ref.current.offsetWidth);\n    const isFailed = isOverflow && fontSize === fontSizePrev;\n    const isAsc = fontSize > fontSizePrev;\n\n    // Return if the font size has been adjusted \"enough\" (change within `resolution`)\n    // reduce font size by one increment if it's overflowing.\n    if (isWithinResolution) {\n      if (isFailed) {\n        isCalculatingRef.current = false;\n        if (logLevel <= LOG_LEVEL.info) {\n          console.info(\n            `[use-fit-text] reached \\`minFontSize = ${minFontSize}\\` without fitting text`,\n          );\n        }\n      } else if (isOverflow) {\n        setState({\n          fontSize: isAsc ? fontSizePrev : fontSizeMin,\n          fontSizeMax,\n          fontSizeMin,\n          fontSizePrev,\n          calcKey,\n        });\n      } else {\n        isCalculatingRef.current = false;\n        onFinish && onFinish(fontSize);\n      }\n      return;\n    }\n\n    // Binary search to adjust font size\n    let delta: number;\n    let newMax = fontSizeMax;\n    let newMin = fontSizeMin;\n    if (isOverflow) {\n      delta = isAsc ? fontSizePrev - fontSize : fontSizeMin - fontSize;\n      newMax = Math.min(fontSizeMax, fontSize);\n    } else {\n      delta = isAsc ? fontSizeMax - fontSize : fontSizePrev - fontSize;\n      newMin = Math.max(fontSizeMin, fontSize);\n    }\n    setState({\n      calcKey,\n      fontSize: fontSize + delta / 2,\n      fontSizeMax: newMax,\n      fontSizeMin: newMin,\n      fontSizePrev: fontSize,\n    });\n  }, [\n    calcKey,\n    fontSize,\n    fontSizeMax,\n    fontSizeMin,\n    fontSizePrev,\n    onFinish,\n    ref,\n    resolution,\n  ]);\n\n  return { fontSize: `${fontSize}%`, ref };\n};\n\nexport default useFitText;\n"]},"metadata":{},"sourceType":"script"}